# test-zips-of-xmls
Тестовое задание

## Постановка задачи

### Неформальная
```
Написать программу на Python, которая делает следующие действия:
1. Создает 50 zip-архивов, в каждом 100 xml файлов со случайными данными следующей структуры:
<root>
<var name=’id’ value=’<случайное уникальное строковое значение>’/>
<var name=’level’ value=’<случайное число от 1 до 100>’/>
<objects>
<object name=’<случайное строковое значение>’/>
<object name=’<случайное строковое значение>’/>
…
</objects>
</root>
В тэге objects случайное число (от 1 до 10) вложенных тэгов object.
2. Обрабатывает директорию с полученными zip архивами, разбирает вложенные xml файлы и формирует 2 csv файла:
Первый: id, level - по одной строке на каждый xml файл
Второй: id, object_name - по отдельной строке для каждого тэга object (получится от 1 до 10 строк на каждый xml файл)
Очень желательно сделать так, чтобы задание 2 эффективно использовало ресурсы многоядерного процессора.
```

### Более формальная
> Ниже - переработка неформальных требований с обобщениями (где это, на мой взгляд, необходимо)

\* для разделения функций будет введет ключ `--mode` со значениями `create` и `analyze`

#### Функция 1:
"Создать архивы с xml-файлами"

Вход программы:
- рабочая директория (через аргументы запуска)
- конфигурационный файл (из текущей директории скрипта), содержащий значения для 
  - `zips` (кол-во zip архивов)
  - `xmls` (кол-во файлов в каждом архиве)
  - `zipname_template` (шаблон для имени zip-файла)

Выход:
- `zips` zip-архивов с `xmls` xml-файлов в каждом

Структура xml-файла:
```xml
<root>
  <var name="id" value="12345"/>
  <var name="level" value="50"/>
  <objects>
    <object name="abc"/>
    <object name="def"/>
  </objects>
</root>
```

#### Функция 2
"Анализ xml-файлов"

Вход программы:
- директория с zip-файлами (через аргументы запуска)
- конфигурационный файл (из текущей директории скрипта), содержащий значения для 
  - `csvname_template` (шаблон для имен csv-файлов)

Выход программы:
- 2 csv-файла (comma-separated, with header, )
  1. В строке - пары значений атрибутов `var.id` - `var.level` для каждого xml файла из всех zip-архивов
  2. В строке - пары значений  `var.id` - `object.name` для каждого `object` в каждом xml файле из всех zip-архивов
  
Прочие требования: эффективное использование ресурсов многоядерного процессора (многопоточность или многопроцессность)


## Реализация
- python3.7
- В решении использованы только стандартные библиотеки
- Все файлы читаются и пишутся в UTF-8

#### Конфигурация:<br>
Наиболее значимые параметры вынесены в конфиг. Остальные параметры генерации - в `modules/generation.py`<br>
Кодировка для чтения и записи - в `modules/utils.py`<br>
Параметры создания CSV файла - в `modules/stats`

#### Запуск (пример):
```shell
# создание zip-файлов
python test-zips-of-xmls.py -m create -w /tmp/testzip
# анализ ВСЕХ zip-файлов из директории
python test-zips-of-xmls.py -m analyze -w /tmp/testzip 
```

### Дисклеймер и TODO
На текущем месте работы я не сталкиваюсь ни с обработкой zip архивов, ни с XML. Выбор библиотек и приемов работы был сделан исходя из общих соображений и предлагаеых сообществом best practices. <br><br>
Задача писалась в качестве тестового задания. Увлекшись, я потратил на нее 3 часа (включая изучение zipfile и ElementTree), что, на мой взгляд, многовато для тестового задания. Так что некоторые необходимые вещи я не сделал:
1. Причесать логирование: вынести уровень в конфиг, вставить пару точек логирования, причесать формат (время, дата, имя модуля и др.)
2. Вынести кодировку в конфиг (да и все прочие константы)
3. Дописать тесты на функции модулей stats и generation
4. Причесать код на предмет более точной обработки ошибок
5. Причесать код на предмет неточных формулировок комментариев 
6. ...
